<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeatherWave - Page D'inscription</title>
  <link rel="stylesheet" href="inscription.css">
  <!-- Ajouter les fichiers CSS et JS de intl-tel-input -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>WeatherWave</h1>
      <p>Rejoignez-nous pour voir des Prévisions Météo Personnalisées !! </p>
    </header>
    <form id="signup-form" action="/signup" method="POST">
      <input type="text" id="name" placeholder="Nom complet" required>
      <input type="email" id="email" placeholder="Adresse email" required readonly>
      <input type="password" id="password" placeholder="Mot de passe" required>
      <input type="password" id="confirm-password" placeholder="Confirmer le mot de passe" required>
      <input type="tel" id="phone" placeholder="Numéro de téléphone" required>
      <input type="date" id="dob" name="dateOfBirth" required />
      <button type="submit" class="login-button">S'inscrire</button>
      <p>Vous avez déjà un compte ? <a href="../index.html">Se connecter</a></p>
    </form>
    <footer>
      <a href="./polit.html">Politique de confidentialité</a>
      <a href="./condition.html">Conditions générales</a>
    </footer>
  </div>
  
  <script src="inscription.js"></script>
  <script>
    // Initialiser le sélecteur de pays avec intl-tel-input
    const phoneInput = document.getElementById('phone');
    const iti = window.intlTelInput(phoneInput, {
      initialCountry: "auto",  // Détecter automatiquement le pays basé sur l'IP de l'utilisateur
      preferredCountries: ['fr', 'us', 'ma'],  // Ajouter quelques pays par défaut dans la liste
      utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js", // nécessaire pour le formatage
    });

    // Fonction pour récupérer le numéro de téléphone avec le préfixe du pays
    function getPhoneNumber() {
      const phoneNumber = iti.getNumber();  // Récupérer le numéro formaté
      return phoneNumber;
    }

    // Générer automatiquement l'email basé sur le nom complet
    document.getElementById('name').addEventListener('input', function() {
      const name = document.getElementById('name').value;
      const emailField = document.getElementById('email');
      if (name) {
        const nameParts = name.split(' ');
        const email = `${nameParts[0].toLowerCase()}.${nameParts[nameParts.length - 1].toLowerCase()}@weather.com`;
        emailField.value = email;
      }
    });

    // Fonction de soumission du formulaire avec validation
    document.getElementById('signup-form').addEventListener('submit', function(event) {
      event.preventDefault(); // Empêcher la soumission par défaut

      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phoneNumber = getPhoneNumber();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;

      // Vérifier que l'email se termine bien par @weather.com
      if (!email.endsWith('@weather.com')) {
        alert('L\'email doit se terminer par @weather.com');
        return;
      }

      // Vérifier que les mots de passe correspondent
      if (password !== confirmPassword) {
        alert('Les mots de passe ne correspondent pas');
        return;
      }

      // Vérifier que le numéro de téléphone est valide
      if (!iti.isValidNumber()) {
        alert('Veuillez entrer un numéro de téléphone valide');
        return;
      }

      // Vérifier que tous les champs sont remplis
      if (!name || !email || !phoneNumber || !password || !confirmPassword || !document.getElementById('dob').value) {
        alert('Tous les champs sont obligatoires');
        return;
      }

      // Soumettre le formulaire si tout est valide
      alert('Inscription réussie !');
      
      // Ajouter la logique pour envoyer les données au serveur ici...
    });
  </script>
</body>
</html>
