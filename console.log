app.post('/signup', async (req, res) => {
  const { email, password, phone, name, dateOfBirth } = req.body;
  
  console.log('Requête reçue :', req.body); // Log les données reçues

  if (!email || !password || !phone || !name || !dateOfBirth) {
    console.error('Champs manquants');
    return res.status(400).json({ message: 'Tous les champs sont obligatoires.' });
  }

  const users = getUsers();
  console.log('Utilisateurs existants :', users);

  if (users.find((user) => user.email === email)) {
    console.error('Email déjà utilisé');
    return res.status(400).json({ message: 'Cet email est déjà utilisé.' });
  }

  const hashedPassword = await bcrypt.hash(password, 10);

  users.push({ email, password: hashedPassword, phone, name, dateOfBirth });
  console.log('Nouvel utilisateur ajouté :', { email, phone, name, dateOfBirth });

  saveUsers(users);

  res.status(201).json({ message: 'Utilisateur enregistré avec succès.' });
});
